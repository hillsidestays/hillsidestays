<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Owner Portal ‚Äî Hillside Stays</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --forest:       #1a3a2a;
      --forest-mid:   #2d5a40;
      --forest-light: #3d7a58;
      --gold:         #c9a84c;
      --gold-light:   #e8c96a;
      --gold-pale:    #f5e9c8;
      --cream:        #faf7f2;
      --mist:         #e8ede9;
      --bark:         #8b6f47;
      --text:         #1a2420;
      --text-mid:     #4a5e52;
      --text-light:   #7a9080;
      --white:        #ffffff;
      --shadow:       0 2px 20px rgba(26,58,42,0.07);
      --shadow-lg:    0 8px 40px rgba(26,58,42,0.13);
      --radius:       14px;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:'DM Sans',sans-serif; background:var(--cream); color:var(--text); min-height:100vh; }

    /* NAV */
    .site-nav { background:var(--forest); padding:0 40px; height:64px; display:flex; align-items:center; justify-content:space-between; position:sticky; top:0; z-index:200; box-shadow:0 2px 20px rgba(0,0,0,0.18); }
    .nav-logo { font-family:'Playfair Display',serif; font-size:20px; font-weight:700; color:var(--white); text-decoration:none; }
    .nav-logo span { color:var(--gold); }
    .nav-links { display:flex; align-items:center; gap:32px; list-style:none; }
    .nav-links a { color:rgba(255,255,255,0.75); text-decoration:none; font-size:14px; font-weight:500; transition:color 0.2s; }
    .nav-links a:hover { color:var(--white); }
    .nav-links a.active { color:var(--gold); }

    /* LOGIN */
    #login-screen { min-height:calc(100vh - 64px); display:flex; align-items:center; justify-content:center; padding:60px 20px; background:radial-gradient(ellipse at 20% 50%,rgba(45,90,64,0.15) 0%,transparent 60%),radial-gradient(ellipse at 80% 20%,rgba(201,168,76,0.1) 0%,transparent 50%),var(--cream); }
    .login-card { background:var(--white); border-radius:20px; box-shadow:var(--shadow-lg); padding:52px 48px; width:100%; max-width:440px; text-align:center; border:1px solid rgba(26,58,42,0.06); animation:fadeUp 0.5s ease both; }
    .login-mark { width:60px; height:60px; background:linear-gradient(135deg,var(--forest),var(--forest-light)); border-radius:16px; display:flex; align-items:center; justify-content:center; font-size:26px; margin:0 auto 24px; box-shadow:0 4px 20px rgba(26,58,42,0.25); }
    .login-card h2 { font-family:'Playfair Display',serif; font-size:26px; font-weight:700; color:var(--forest); margin-bottom:6px; }
    .login-card .sub { font-size:14px; color:var(--text-light); margin-bottom:36px; }
    .form-group { text-align:left; margin-bottom:18px; }
    .form-group label { display:block; font-size:12px; font-weight:600; text-transform:uppercase; letter-spacing:1.2px; color:var(--text-mid); margin-bottom:8px; }
    .form-group input { width:100%; padding:13px 16px; border:1.5px solid var(--mist); border-radius:10px; font-family:'DM Sans',sans-serif; font-size:15px; color:var(--text); background:var(--cream); transition:border-color 0.2s,box-shadow 0.2s; outline:none; }
    .form-group input:focus { border-color:var(--forest-light); box-shadow:0 0 0 3px rgba(61,122,88,0.12); background:var(--white); }
    .login-btn { width:100%; padding:14px; background:var(--forest); color:var(--white); border:none; border-radius:10px; font-family:'DM Sans',sans-serif; font-size:15px; font-weight:600; cursor:pointer; margin-top:8px; transition:background 0.2s,transform 0.15s; }
    .login-btn:hover { background:var(--forest-mid); transform:translateY(-1px); }
    .login-btn:active { transform:translateY(0); }
    .login-error { display:none; background:#fdf0f0; color:#c0392b; border-radius:8px; padding:10px 14px; font-size:13px; font-weight:500; margin-top:14px; text-align:left; }
    .login-error.show { display:block; }
    .login-footer { margin-top:28px; font-size:12px; color:var(--text-light); line-height:1.6; }
    .login-footer a { color:var(--forest-mid); text-decoration:none; font-weight:600; }

    /* LOADING */
    #loading-screen { min-height:calc(100vh - 64px); align-items:center; justify-content:center; flex-direction:column; gap:20px; }
    .spinner { width:40px; height:40px; border:3px solid var(--mist); border-top-color:var(--forest-mid); border-radius:50%; animation:spin 0.8s linear infinite; }
    @keyframes spin { to { transform:rotate(360deg); } }
    .loading-text { font-size:14px; color:var(--text-light); font-weight:500; }

    /* PORTAL */
    #portal-screen { display:none; }
    .portal-topbar { background:var(--white); border-bottom:1px solid var(--mist); padding:0 36px; height:60px; display:flex; align-items:center; justify-content:space-between; }
    .portal-topbar-left { display:flex; align-items:center; gap:14px; }
    .portal-property-name { font-family:'Playfair Display',serif; font-size:18px; font-weight:600; color:var(--forest); }
    .period-badge { background:var(--gold-pale); color:var(--bark); font-size:11px; font-weight:700; letter-spacing:1px; text-transform:uppercase; padding:5px 12px; border-radius:20px; }
    .live-badge { background:#e8f5ec; color:#2d7a44; font-size:10px; font-weight:700; letter-spacing:1px; text-transform:uppercase; padding:4px 10px; border-radius:20px; display:flex; align-items:center; gap:5px; }
    .live-dot { width:6px; height:6px; border-radius:50%; background:#2d7a44; animation:pulse 2s ease-in-out infinite; }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.3} }
    .topbar-right { display:flex; align-items:center; gap:12px; }
    .owner-pill { display:flex; align-items:center; gap:8px; background:var(--mist); padding:6px 14px 6px 8px; border-radius:20px; }
    .owner-pill .av { width:26px; height:26px; border-radius:50%; background:linear-gradient(135deg,var(--forest-mid),var(--forest-light)); display:flex; align-items:center; justify-content:center; font-size:11px; font-weight:700; color:var(--white); }
    .owner-pill .name { font-size:13px; font-weight:600; color:var(--forest); }
    .refresh-btn { background:none; border:1.5px solid var(--mist); color:var(--text-light); font-family:'DM Sans',sans-serif; font-size:12px; font-weight:600; padding:6px 12px; border-radius:8px; cursor:pointer; transition:all 0.18s; }
    .refresh-btn:hover { border-color:var(--forest-light); color:var(--forest); }
    .logout-btn { background:none; border:1.5px solid var(--mist); color:var(--text-light); font-family:'DM Sans',sans-serif; font-size:12px; font-weight:600; padding:6px 14px; border-radius:8px; cursor:pointer; transition:all 0.18s; }
    .logout-btn:hover { border-color:var(--forest); color:var(--forest); }

    /* TABS */
    .portal-tabs { background:var(--white); border-bottom:1px solid var(--mist); padding:0 36px; display:flex; }
    .tab-btn { padding:14px 20px; font-family:'DM Sans',sans-serif; font-size:13px; font-weight:500; color:var(--text-light); background:none; border:none; border-bottom:2px solid transparent; cursor:pointer; transition:all 0.18s; white-space:nowrap; }
    .tab-btn:hover { color:var(--forest); }
    .tab-btn.active { color:var(--forest); border-bottom-color:var(--gold); font-weight:600; }

    /* CONTENT */
    .portal-content { padding:32px 36px; }
    .tab-pane { display:none; }
    .tab-pane.active { display:block; animation:fadeUp 0.3s ease both; }

    /* CARDS */
    .card { background:var(--white); border-radius:var(--radius); box-shadow:var(--shadow); border:1px solid rgba(26,58,42,0.05); overflow:hidden; }
    .card-header { padding:18px 24px 14px; border-bottom:1px solid var(--mist); display:flex; align-items:center; justify-content:space-between; }
    .card-title { font-family:'Playfair Display',serif; font-size:16px; font-weight:600; color:var(--forest); }
    .card-meta { font-size:12px; color:var(--text-light); }

    /* STATS */
    .stats-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:16px; margin-bottom:24px; }
    .stat-card { background:var(--white); border-radius:var(--radius); padding:22px 22px 18px; box-shadow:var(--shadow); border:1px solid rgba(26,58,42,0.05); position:relative; overflow:hidden; transition:transform 0.2s,box-shadow 0.2s; }
    .stat-card:hover { transform:translateY(-2px); box-shadow:var(--shadow-lg); }
    .stat-card::before { content:''; position:absolute; top:0; left:0; right:0; height:3px; border-radius:var(--radius) var(--radius) 0 0; }
    .stat-card.green::before { background:var(--forest-light); }
    .stat-card.gold::before  { background:var(--gold); }
    .stat-card.bark::before  { background:var(--bark); }
    .stat-card.muted::before { background:var(--text-light); }
    .stat-label { font-size:10px; text-transform:uppercase; letter-spacing:1.5px; color:var(--text-light); font-weight:600; margin-bottom:10px; }
    .stat-value { font-family:'Playfair Display',serif; font-size:28px; font-weight:700; color:var(--forest); line-height:1; }
    .stat-sub { font-size:11px; color:var(--text-light); margin-top:6px; }
    .delta { display:inline-flex; align-items:center; gap:3px; font-size:11px; font-weight:700; padding:3px 8px; border-radius:20px; margin-top:10px; }
    .up   { background:#e8f5ec; color:#2d7a44; }
    .down { background:#fdf0f0; color:#c0392b; }

    /* LAYOUT */
    .two-col { display:grid; grid-template-columns:1fr 360px; gap:18px; margin-bottom:18px; }
    .bottom-grid { display:grid; grid-template-columns:1fr 1fr; gap:18px; }

    /* RES TABLE */
    .res-table { width:100%; border-collapse:collapse; }
    .res-table th { text-align:left; font-size:10px; text-transform:uppercase; letter-spacing:1.4px; color:var(--text-light); font-weight:600; padding:10px 20px; background:var(--cream); border-bottom:1px solid var(--mist); }
    .res-table td { padding:13px 20px; font-size:13px; border-bottom:1px solid var(--mist); }
    .res-table tr:last-child td { border-bottom:none; }
    .res-table tr:hover td { background:rgba(26,58,42,0.015); }
    .g-name { font-weight:600; color:var(--forest); }
    .g-meta { font-size:11px; color:var(--text-light); margin-top:2px; }
    .platform { display:inline-block; font-size:9px; font-weight:800; letter-spacing:0.8px; padding:3px 7px; border-radius:4px; text-transform:uppercase; }
    .airbnb { background:#ffeee8; color:#e8474d; }
    .vrbo   { background:#e8f0fe; color:#2457c5; }
    .direct { background:var(--gold-pale); color:var(--bark); }
    .status { display:inline-flex; align-items:center; gap:5px; font-size:11px; font-weight:600; padding:4px 9px; border-radius:20px; }
    .dot { width:5px; height:5px; border-radius:50%; background:currentColor; }
    .confirmed { background:#e8f5ec; color:#2d7a44; }
    .upcoming  { background:#fff8e8; color:#a07820; }
    .completed { background:var(--mist); color:var(--text-light); }
    .payout-val { font-family:'Playfair Display',serif; font-weight:600; color:var(--forest); font-size:14px; }

    /* EARNINGS */
    .earn-panel { padding:16px 24px 20px; }
    .earn-row { display:flex; align-items:center; padding:10px 0; border-bottom:1px solid var(--mist); gap:12px; }
    .earn-row:last-child { border-bottom:none; }
    .earn-month { min-width:80px; }
    .earn-month .mn { font-size:13px; font-weight:500; }
    .earn-month .ni { font-size:11px; color:var(--text-light); }
    .earn-bar-wrap { flex:1; height:6px; background:var(--mist); border-radius:3px; overflow:hidden; }
    .earn-bar { height:100%; background:linear-gradient(90deg,var(--forest-mid),var(--forest-light)); border-radius:3px; transition:width 0.8s ease; }
    .earn-amount { min-width:68px; text-align:right; font-family:'Playfair Display',serif; font-size:14px; font-weight:600; color:var(--forest); }

    /* BREAKDOWN */
    .breakdown { padding:16px 24px 20px; }
    .brow { display:flex; justify-content:space-between; align-items:center; padding:11px 0; border-bottom:1px solid var(--mist); font-size:13px; }
    .brow:last-child { border-bottom:none; padding-top:16px; border-top:2px solid var(--mist); }
    .brow .bl { color:var(--text-mid); }
    .brow .bv { font-weight:600; }
    .brow.neg .bv { color:#c0392b; }
    .brow.total .bl { font-family:'Playfair Display',serif; font-size:16px; font-weight:600; color:var(--forest); }
    .brow.total .bv { font-family:'Playfair Display',serif; font-size:22px; color:var(--forest); }

    /* NOTICES */
    .notices { padding:14px 20px 18px; display:flex; flex-direction:column; gap:10px; }
    .notice { display:flex; gap:12px; background:var(--cream); border-radius:10px; padding:13px 15px; border-left:3px solid var(--gold); }
    .notice.info  { border-left-color:var(--forest-light); }
    .notice.alert { border-left-color:#e67e22; background:#fef9f5; }
    .notice-icon  { font-size:15px; flex-shrink:0; margin-top:1px; }
    .notice-title { font-size:13px; font-weight:600; color:var(--forest); }
    .notice-body  { font-size:12px; color:var(--text-mid); margin-top:3px; line-height:1.5; }

    /* YTD */
    .ytd-banner { background:linear-gradient(135deg,var(--forest),var(--forest-mid)); border-radius:var(--radius); padding:28px 32px; margin-bottom:20px; display:flex; gap:48px; align-items:center; position:relative; overflow:hidden; }
    .ytd-banner::after { content:'‚õ∞'; position:absolute; right:32px; font-size:80px; opacity:0.07; pointer-events:none; }
    .ytd-item .label { font-size:10px; text-transform:uppercase; letter-spacing:1.5px; color:rgba(255,255,255,0.55); font-weight:600; margin-bottom:6px; }
    .ytd-item .value { font-family:'Playfair Display',serif; font-size:32px; font-weight:700; color:var(--white); }
    .ytd-item .sub { font-size:12px; color:rgba(255,255,255,0.5); margin-top:4px; }
    .ytd-divider { width:1px; height:60px; background:rgba(255,255,255,0.15); }

    /* FILTER */
    .filter-row { display:flex; gap:10px; margin-bottom:18px; flex-wrap:wrap; }
    .filter-btn { padding:7px 16px; border-radius:20px; border:1.5px solid var(--mist); background:var(--white); font-family:'DM Sans',sans-serif; font-size:12px; font-weight:600; color:var(--text-light); cursor:pointer; transition:all 0.18s; }
    .filter-btn:hover  { border-color:var(--forest); color:var(--forest); }
    .filter-btn.active { background:var(--forest); border-color:var(--forest); color:var(--white); }

    /* ERROR */
    .error-banner { background:#fdf0f0; color:#c0392b; border-radius:10px; padding:14px 18px; font-size:13px; font-weight:500; margin-bottom:20px; display:none; }
    .error-banner.show { display:block; }

    /* SHEET HINT */
    .sheet-hint { background:linear-gradient(90deg,rgba(201,168,76,0.12),rgba(201,168,76,0.04)); border:1px dashed rgba(201,168,76,0.5); border-radius:10px; padding:12px 18px; font-size:12px; color:var(--bark); margin-bottom:20px; display:flex; align-items:center; gap:10px; }

    /* DOCS */
    .doc-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:16px; }
    .doc-card { background:var(--white); border-radius:var(--radius); padding:22px; box-shadow:var(--shadow); border:1px solid rgba(26,58,42,0.05); display:flex; flex-direction:column; gap:10px; transition:transform 0.2s,box-shadow 0.2s; }
    .doc-card:hover { transform:translateY(-2px); box-shadow:var(--shadow-lg); }
    .doc-icon { font-size:28px; }
    .doc-name { font-size:14px; font-weight:600; color:var(--forest); }
    .doc-meta { font-size:11px; color:var(--text-light); }
    .doc-btn { margin-top:auto; padding:8px 16px; background:var(--forest); color:var(--white); border:none; border-radius:8px; font-family:'DM Sans',sans-serif; font-size:12px; font-weight:600; cursor:pointer; text-decoration:none; display:inline-block; transition:background 0.18s; align-self:flex-start; }
    .doc-btn:hover { background:var(--forest-mid); }

    /* MESSAGES */
    .message-layout { display:grid; grid-template-columns:280px 1fr; background:var(--white); border-radius:var(--radius); box-shadow:var(--shadow); border:1px solid rgba(26,58,42,0.05); overflow:hidden; min-height:480px; }
    .msg-sidebar { border-right:1px solid var(--mist); }
    .msg-sidebar-header { padding:18px 20px; border-bottom:1px solid var(--mist); font-family:'Playfair Display',serif; font-size:16px; font-weight:600; color:var(--forest); }
    .msg-thread { padding:14px 20px; border-bottom:1px solid var(--mist); cursor:pointer; transition:background 0.15s; }
    .msg-thread:hover,.msg-thread.active { background:var(--cream); }
    .msg-thread .mt-name { font-size:13px; font-weight:600; color:var(--forest); }
    .msg-thread .mt-preview { font-size:12px; color:var(--text-light); margin-top:2px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .msg-thread .mt-time { font-size:10px; color:var(--text-light); float:right; }
    .msg-main { display:flex; flex-direction:column; }
    .msg-header { padding:18px 24px; border-bottom:1px solid var(--mist); font-size:14px; font-weight:600; color:var(--forest); }
    .msg-body { flex:1; padding:24px; display:flex; flex-direction:column; gap:16px; overflow-y:auto; max-height:360px; }
    .bubble-row { display:flex; gap:10px; }
    .bubble-row.me { flex-direction:row-reverse; }
    .bubble-av { width:32px; height:32px; border-radius:50%; background:var(--forest-mid); display:flex; align-items:center; justify-content:center; font-size:12px; font-weight:700; color:var(--white); flex-shrink:0; }
    .bubble-av.gold-av { background:linear-gradient(135deg,var(--gold),var(--bark)); }
    .bubble { max-width:70%; padding:11px 15px; border-radius:14px; font-size:13px; line-height:1.55; }
    .bubble.them { background:var(--mist); color:var(--text); border-bottom-left-radius:4px; }
    .bubble.me   { background:var(--forest); color:var(--white); border-bottom-right-radius:4px; }
    .bubble-time { font-size:10px; color:var(--text-light); margin-top:4px; }
    .bubble-row.me .bubble-time { text-align:right; }
    .msg-notice { font-size:12px; color:var(--text-light); text-align:center; margin:0 24px 12px; background:var(--gold-pale); padding:8px 14px; border-radius:8px; }
    .msg-compose { padding:16px 24px; border-top:1px solid var(--mist); display:flex; gap:10px; }
    .msg-input { flex:1; padding:11px 16px; border:1.5px solid var(--mist); border-radius:10px; font-family:'DM Sans',sans-serif; font-size:13px; color:var(--text); resize:none; outline:none; transition:border-color 0.2s; background:var(--cream); }
    .msg-input:focus { border-color:var(--forest-light); background:var(--white); }
    .send-btn { padding:11px 20px; background:var(--forest); color:var(--white); border:none; border-radius:10px; font-family:'DM Sans',sans-serif; font-size:13px; font-weight:600; cursor:pointer; transition:background 0.18s; }
    .send-btn:hover { background:var(--forest-mid); }

    @keyframes fadeUp { from{opacity:0;transform:translateY(14px)} to{opacity:1;transform:translateY(0)} }

    @media(max-width:1050px){.stats-grid{grid-template-columns:repeat(2,1fr)}.two-col,.bottom-grid{grid-template-columns:1fr}.doc-grid{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:700px){.site-nav{padding:0 20px}.nav-links{display:none}.portal-content{padding:20px 16px}.portal-topbar{padding:0 16px}.portal-tabs{padding:0 16px;overflow-x:auto}.stats-grid{grid-template-columns:1fr 1fr;gap:10px}.message-layout{grid-template-columns:1fr}.msg-sidebar{display:none}.doc-grid{grid-template-columns:1fr}.ytd-banner{flex-direction:column;gap:20px;padding:24px}.ytd-divider{display:none}}
  </style>
</head>
<body>

<nav class="site-nav">
  <a class="nav-logo" href="index.html">Hillside<span> Stays</span></a>
  <ul class="nav-links">
    <li><a href="index.html">Home</a></li>
    <li><a href="index.html#services">Services</a></li>
    <li><a href="index.html#how-it-works">How It Works</a></li>
    <li><a href="index.html#contact">Contact</a></li>
    <li><a href="owner-portal.html" class="active">Owner Portal</a></li>
  </ul>
</nav>

<div id="login-screen">
  <div class="login-card">
    <div class="login-mark">üè°</div>
    <h2>Owner Portal</h2>
    <p class="sub">Sign in to view your property dashboard</p>
    <div class="form-group">
      <label>Email Address</label>
      <input type="email" id="login-email" placeholder="you@email.com" autocomplete="email"/>
    </div>
    <div class="form-group">
      <label>Access Code</label>
      <input type="password" id="login-pass" placeholder="Your access code"/>
    </div>
    <button class="login-btn" id="login-btn">Sign In ‚Üí</button>
    <div class="login-error" id="login-error">‚ö† Incorrect email or access code. Contact your Hillside Stays account manager.</div>
    <div class="login-footer">Don't have access yet?<br/><a id="setup-link" href="#">Contact Dylan to get set up ‚Üí</a></div>
  </div>
</div>

<div id="loading-screen" style="display:none;min-height:calc(100vh - 64px);align-items:center;justify-content:center;flex-direction:column;gap:20px;">
  <div class="spinner"></div>
  <div class="loading-text">Loading your dashboard‚Ä¶</div>
</div>

<div id="portal-screen">
  <div class="portal-topbar">
    <div class="portal-topbar-left">
      <div class="portal-property-name" id="display-property">‚Äî</div>
      <div class="period-badge" id="display-period">‚Äî</div>
      <div class="live-badge"><div class="live-dot"></div> Live Data</div>
    </div>
    <div class="topbar-right">
      <button class="refresh-btn" onclick="refreshData()">‚Üª Refresh</button>
      <div class="owner-pill">
        <div class="av" id="display-initials">‚Äî</div>
        <div class="name" id="display-name">‚Äî</div>
      </div>
      <button class="logout-btn" onclick="handleLogout()">Sign Out</button>
    </div>
  </div>

  <div class="portal-tabs">
    <button class="tab-btn active" onclick="switchTab('dashboard',this)">Dashboard</button>
    <button class="tab-btn" onclick="switchTab('reservations',this)">Reservations</button>
    <button class="tab-btn" onclick="switchTab('earnings',this)">Earnings</button>
    <button class="tab-btn" onclick="switchTab('messages',this)">Messages</button>
    <button class="tab-btn" onclick="switchTab('documents',this)">Documents</button>
  </div>

  <div class="portal-content">
    <div class="error-banner" id="error-banner">‚ö† Could not load data from Google Sheets. Check your internet connection or contact Dylan.</div>

    <div class="tab-pane active" id="tab-dashboard">
      <div class="sheet-hint">üìä <span><strong>Dylan ‚Äî Admin note:</strong> Update your Google Sheet and owners see changes instantly on refresh. No code edits needed.</span></div>
      <div class="stats-grid">
        <div class="stat-card green"><div class="stat-label">Gross Revenue</div><div class="stat-value" id="s-revenue">‚Äî</div><div class="stat-sub" id="s-revenue-sub">‚Äî</div><div class="delta up" id="s-revenue-delta">‚Äî</div></div>
        <div class="stat-card gold"><div class="stat-label">Your Payout</div><div class="stat-value" id="s-payout">‚Äî</div><div class="stat-sub">After 18% management fee</div><div class="delta up" id="s-payout-delta">‚Äî</div></div>
        <div class="stat-card bark"><div class="stat-label">Occupancy Rate</div><div class="stat-value" id="s-occ">‚Äî</div><div class="stat-sub" id="s-occ-sub">‚Äî</div><div class="delta up" id="s-occ-delta">‚Äî</div></div>
        <div class="stat-card muted"><div class="stat-label">Avg Nightly Rate</div><div class="stat-value" id="s-rate">‚Äî</div><div class="stat-sub">Dynamic pricing active</div><div class="delta" id="s-rate-delta">‚Äî</div></div>
      </div>
      <div class="two-col">
        <div class="card">
          <div class="card-header"><div class="card-title">Upcoming Reservations</div><div class="card-meta" id="upcoming-count">‚Äî</div></div>
          <table class="res-table"><thead><tr><th>Guest</th><th>Dates</th><th>Platform</th><th>Status</th><th>Your Payout</th></tr></thead><tbody id="upcoming-tbody"></tbody></table>
        </div>
        <div class="card">
          <div class="card-header"><div class="card-title">Monthly Earnings</div></div>
          <div class="earn-panel" id="earn-panel"></div>
        </div>
      </div>
      <div class="bottom-grid">
        <div class="card">
          <div class="card-header"><div class="card-title">Payout Breakdown</div><div class="card-meta" id="breakdown-period">‚Äî</div></div>
          <div class="breakdown" id="breakdown"></div>
        </div>
        <div>
          <div class="card" style="margin-bottom:16px">
            <div class="card-header"><div class="card-title">Updates from Your Team</div></div>
            <div class="notices" id="notices-panel"></div>
          </div>
          <div class="card">
            <div class="card-header"><div class="card-title">Your Hillside Stays Team</div></div>
            <div class="breakdown">
              <div class="brow"><span class="bl">Dylan Smith ‚Äî Account Manager</span><a id="team-link-1" href="#" style="font-size:12px;font-weight:600;color:var(--forest-mid);text-decoration:none">‚úâ Email</a></div>
              <div class="brow"><span class="bl">24/7 Guest Support</span><a id="team-link-2" href="#" style="font-size:12px;font-weight:600;color:var(--forest-mid);text-decoration:none">‚úâ Email</a></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="tab-pane" id="tab-reservations">
      <div class="filter-row">
        <button class="filter-btn active" data-filter="all">All</button>
        <button class="filter-btn" data-filter="confirmed">Confirmed</button>
        <button class="filter-btn" data-filter="upcoming">Upcoming</button>
        <button class="filter-btn" data-filter="completed">Completed</button>
      </div>
      <div class="card">
        <table class="res-table"><thead><tr><th>Guest</th><th>Check-In</th><th>Check-Out</th><th>Nights</th><th>Platform</th><th>Status</th><th>Your Payout</th></tr></thead><tbody id="all-res-tbody"></tbody></table>
      </div>
    </div>

    <div class="tab-pane" id="tab-earnings">
      <div class="ytd-banner">
        <div class="ytd-item"><div class="label">Year-to-Date Gross Revenue</div><div class="value" id="ytd-gross">‚Äî</div><div class="sub">2026</div></div>
        <div class="ytd-divider"></div>
        <div class="ytd-item"><div class="label">Year-to-Date Your Payout</div><div class="value" id="ytd-payout">‚Äî</div><div class="sub">After management fee</div></div>
        <div class="ytd-divider"></div>
        <div class="ytd-item"><div class="label">Total Nights Booked</div><div class="value" id="ytd-nights">‚Äî</div><div class="sub">Year to date</div></div>
      </div>
      <div class="card">
        <div class="card-header"><div class="card-title">Monthly Breakdown</div></div>
        <table class="res-table"><thead><tr><th>Month</th><th>Nights</th><th>Occupancy</th><th>Gross Revenue</th><th>Management Fee</th><th>Your Payout</th></tr></thead><tbody id="earnings-tbody"></tbody></table>
      </div>
    </div>

    <div class="tab-pane" id="tab-messages">
      <div class="message-layout">
        <div class="msg-sidebar">
          <div class="msg-sidebar-header">Messages</div>
          <div class="msg-thread active"><span class="mt-time">Today</span><div class="mt-name">Dylan Smith</div><div class="mt-preview">Updates from your account manager</div></div>
        </div>
        <div class="msg-main">
          <div class="msg-header">Dylan Smith ‚Äî Account Manager</div>
          <div class="msg-body" id="msg-body">
            <div class="bubble-row"><div class="bubble-av">DS</div><div><div class="bubble them">Welcome to your Hillside Stays owner portal! Your dashboard is now live and pulling real-time data. Reach out anytime with questions!</div><div class="bubble-time">Today</div></div></div>
          </div>
          <div class="msg-notice">For urgent issues, use the Send button below to message Dylan directly.</div>
          <div class="msg-compose">
            <textarea class="msg-input" id="msg-input" rows="2" placeholder="Send a message to your Hillside Stays team‚Ä¶"></textarea>
            <button class="send-btn" onclick="sendMessage()">Send</button>
          </div>
        </div>
      </div>
    </div>

    <div class="tab-pane" id="tab-documents">
      <div class="doc-grid" id="doc-grid"></div>
    </div>

  </div>
</div>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   HOW EMAILS WORK IN THIS FILE
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   Cloudflare obfuscates any email address it finds in
   plain HTML text, which breaks the login. To prevent
   this, emails are assembled from parts by JavaScript
   at runtime ‚Äî Cloudflare never sees a full address.

   To add a new owner:
   { email: e('theirname','gmail.com'), code: "CODE", name: "Full Name", initials: "XX" }
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

// Assembles an email from two parts ‚Äî invisible to Cloudflare's scanner
function e(user, domain) { return user + '\x40' + domain; }

const CONFIG = {
  owners: [
    {
      email:    e('smithdj789','gmail.com'),
      code:     "HILLSIDE01",
      name:     "Dylan Smith",
      initials: "DS",
      sheetUrl: "https://docs.google.com/spreadsheets/d/e/2PACX-1vS3h3RRYpOyQFAg3Aw6zMjD1skmAwneJdsye6AlpSB4ibFdS1I-YIk62Z9TGAtKb4Vf2h5go1-WaoOp/pub?output=csv",
    },
    {
      email:    e('testowner','hillsidestays.net'),
      code:     "RIDGE2026",
      name:     "Jane Doe",
      initials: "JD",
      sheetUrl: "JANE_SHEET_URL_PLACEHOLDER",
    },
    // ‚îÄ‚îÄ TO ADD A NEW OWNER ‚îÄ‚îÄ
    // 1. Create a new tab in the Google Sheet for their property
    // 2. Publish that tab as CSV (File ‚Üí Share ‚Üí Publish to web ‚Üí pick their tab ‚Üí CSV)
    // 3. Paste the URL as their sheetUrl below
    // 4. Fill in email (split at @), code, name, initials
    // 5. Upload to GitHub and commit
    // { email: e('newowner','gmail.com'), code: "CODE2026", name: "Full Name", initials: "XX", sheetUrl: "THEIR_CSV_URL" },
  ],
};

// Wire up all email links safely after page loads
document.addEventListener('DOMContentLoaded', () => {
  const contact = e('smithdj789','gmail.com');
  const g = id => document.getElementById(id);
  if (g('setup-link'))  g('setup-link').href  = 'mailto:' + contact + '?subject=Owner%20Portal%20Access';
  if (g('team-link-1')) g('team-link-1').href  = 'mailto:' + contact;
  if (g('team-link-2')) g('team-link-2').href  = 'mailto:' + contact + '?subject=Urgent%20Guest%20Issue';
  document.getElementById('login-btn').addEventListener('click', handleLogin);
  document.getElementById('login-pass').addEventListener('keydown', ev => { if(ev.key==='Enter') handleLogin(); });
  const saved = sessionStorage.getItem('hs_owner');
  if (saved) { currentOwner = JSON.parse(saved); loadAndShow(currentOwner); }
});

let sheetData = {};
let currentOwner = null;

/* ‚îÄ‚îÄ AUTH ‚îÄ‚îÄ */
function handleLogin() {
  const email = document.getElementById('login-email').value.trim().toLowerCase();
  const code  = document.getElementById('login-pass').value.trim();
  const owner = CONFIG.owners.find(o => o.email.toLowerCase() === email && o.code === code);
  if (owner) {
    document.getElementById('login-error').classList.remove('show');
    currentOwner = owner;
    sessionStorage.setItem('hs_owner', JSON.stringify(owner));
    loadAndShow(owner);
  } else {
    document.getElementById('login-error').classList.add('show');
  }
}

function handleLogout() {
  sessionStorage.removeItem('hs_owner');
  currentOwner = null;
  show('login-screen','flex');
  hide('portal-screen');
}

/* ‚îÄ‚îÄ LOAD ‚îÄ‚îÄ */
async function loadAndShow(owner) {
  hide('login-screen');
  show('loading-screen','flex');
  try {
    await fetchSheet();
    hide('loading-screen');
    show('portal-screen','block');
    populate(owner);
  } catch(err) {
    hide('loading-screen');
    show('portal-screen','block');
    document.getElementById('error-banner').classList.add('show');
    populate(owner);
  }
}

async function refreshData() {
  const btn = document.querySelector('.refresh-btn');
  btn.textContent = '‚Üª Refreshing‚Ä¶'; btn.disabled = true;
  try {
    await fetchSheet();
    populate(currentOwner);
    document.getElementById('error-banner').classList.remove('show');
  } catch(err) {
    document.getElementById('error-banner').classList.add('show');
  }
  btn.textContent = '‚Üª Refresh'; btn.disabled = false;
}

/* ‚îÄ‚îÄ FETCH & PARSE ‚îÄ‚îÄ */
async function fetchSheet() {
  const url = currentOwner && currentOwner.sheetUrl ? currentOwner.sheetUrl : '';
  if (!url || url === 'JANE_SHEET_URL_PLACEHOLDER') throw new Error('No sheet URL configured for this owner');
  const res = await fetch(url + '&t=' + Date.now());
  if (!res.ok) throw new Error('fetch failed');
  sheetData = parseCSV(await res.text());
}

function parseCSV(csv) {
  const lines = csv.split('\n');
  const kv = {}, sections = {};
  let sec = null, secRows = [], inHeader = false;
  for (const line of lines) {
    const cols = splitLine(line);
    const a = (cols[0]||'').trim();
    if (!a) continue;
    if (['RESERVATIONS','MONTHLY_EARNINGS','NOTICES','DOCUMENTS'].includes(a.toUpperCase())) {
      if (sec) sections[sec] = secRows;
      sec = a.toUpperCase(); secRows = []; inHeader = true;
      continue;
    }
    if (sec) {
      if (inHeader) { inHeader = false; continue; }
      if (cols.slice(1).some(c => c.trim())) secRows.push(cols.map(c => c.trim()));
    } else {
      kv[a] = (cols[1]||'').trim();
    }
  }
  if (sec) sections[sec] = secRows;
  return { kv, sections };
}

function splitLine(line) {
  const result = []; let cur = ''; let inQ = false;
  for (let i = 0; i < line.length; i++) {
    const ch = line[i];
    if (ch === '"') { inQ = !inQ; continue; }
    if (ch === ',' && !inQ) { result.push(cur); cur = ''; continue; }
    cur += ch;
  }
  result.push(cur);
  return result;
}

/* ‚îÄ‚îÄ POPULATE ‚îÄ‚îÄ */
function populate(owner) {
  const kv = sheetData.kv || {};
  const sc = sheetData.sections || {};

  setText('display-name',     owner.name);
  setText('display-initials', owner.initials);
  setText('display-property', kv.property_name || 'Your Property');
  setText('display-period',   kv.period || '');

  setStat('s-revenue', fmtStat(kv.stat_revenue,'revenue'), kv.stat_revenue_sub,  kv.stat_revenue_delta, kv.stat_revenue_up !== 'false');
  setStat('s-payout',  fmtStat(kv.stat_payout,'payout'),   'After 18% mgmt fee', kv.stat_payout_delta,  kv.stat_payout_up  !== 'false');
  setStat('s-occ',     fmtStat(kv.stat_occ,'occ'),         kv.stat_occ_sub,      kv.stat_occ_delta,     kv.stat_occ_up     !== 'false');
  setStat('s-rate',    fmtStat(kv.stat_rate,'rate'),        'Dynamic pricing',    kv.stat_rate_delta,    kv.stat_rate_up    === 'true');

  const allRes   = sc['RESERVATIONS'] || [];
  const upcoming = allRes.filter(r => (r[6]||'').toLowerCase() !== 'completed');
  setText('upcoming-count', upcoming.length + ' upcoming');

  document.getElementById('upcoming-tbody').innerHTML = upcoming.length
    ? upcoming.map(r => `<tr>
        <td><div class="g-name">${r[0]}</div><div class="g-meta">${r[1]}</div></td>
        <td>${r[2]}‚Äì${r[3]}</td>
        <td><span class="platform ${platC(r[5])}">${(r[5]||'').toUpperCase()}</span></td>
        <td><span class="status ${statC(r[6])}"><span class="dot"></span>${cap(r[6])}</span></td>
        <td><span class="payout-val">${r[7]}</span></td>
      </tr>`).join('')
    : '<tr><td colspan="5" style="padding:32px;text-align:center;color:var(--text-light)">No upcoming reservations</td></tr>';

  document.getElementById('all-res-tbody').innerHTML = allRes.length
    ? allRes.map(r => `<tr data-status="${statC(r[6])}">
        <td><div class="g-name">${r[0]}</div><div class="g-meta">${r[1]}</div></td>
        <td>${r[2]}</td><td>${r[3]}</td><td>${r[4]}</td>
        <td><span class="platform ${platC(r[5])}">${(r[5]||'').toUpperCase()}</span></td>
        <td><span class="status ${statC(r[6])}"><span class="dot"></span>${cap(r[6])}</span></td>
        <td><span class="payout-val">${r[7]}</span></td>
      </tr>`).join('')
    : '<tr><td colspan="7" style="padding:32px;text-align:center;color:var(--text-light)">No reservations yet</td></tr>';

  const earn = sc['MONTHLY_EARNINGS'] || [];
  const maxP = Math.max(...earn.map(r => pd(r[5])), 1);
  document.getElementById('earn-panel').innerHTML = earn.length
    ? earn.map(r => `<div class="earn-row">
        <div class="earn-month"><div class="mn">${r[0]}</div><div class="ni">${r[1]} nights</div></div>
        <div class="earn-bar-wrap"><div class="earn-bar" style="width:${Math.round(pd(r[5])/maxP*100)}%"></div></div>
        <div class="earn-amount">${r[5]}</div>
      </div>`).join('')
    : '<div style="padding:24px;color:var(--text-light);font-size:13px">No earnings data yet</div>';

  const ytdG = earn.reduce((s,r) => s + pd(r[3]), 0);
  const ytdP = earn.reduce((s,r) => s + pd(r[5]), 0);
  const ytdN = earn.reduce((s,r) => s + (parseInt(r[1])||0), 0);
  setText('ytd-gross',  fmtStat(kv.ytd_gross  || fmt(ytdG), 'gross'));
  setText('ytd-payout', fmtStat(kv.ytd_payout || fmt(ytdP), 'payout'));
  setText('ytd-nights', kv.ytd_nights || String(ytdN));

  document.getElementById('earnings-tbody').innerHTML = earn.length
    ? earn.map(r => `<tr>
        <td><strong>${r[0]}</strong></td>
        <td>${r[1]}</td><td>${r[2]}</td>
        <td><span class="payout-val">${r[3]}</span></td>
        <td style="color:#c0392b">${r[4]}</td>
        <td><span class="payout-val">${r[5]}</span></td>
      </tr>`).join('')
    : '<tr><td colspan="6" style="padding:32px;text-align:center;color:var(--text-light)">No earnings data yet</td></tr>';

  setText('breakdown-period', kv.period || '');
  document.getElementById('breakdown').innerHTML = `
    <div class="brow"><span class="bl">Total Gross Revenue</span><span class="bv">${fmtStat(kv.bd_gross,'gross')}</span></div>
    <div class="brow"><span class="bl">Cleaning Fees (pass-through)</span><span class="bv">${fmtStat(kv.bd_cleaning,'gross')}</span></div>
    <div class="brow neg"><span class="bl">Management Fee (18%)</span><span class="bv">${fmtStat(kv.bd_fee,'gross')}</span></div>
    <div class="brow"><span class="bl">Maintenance Costs</span><span class="bv">${kv.bd_maintenance == '0' || kv.bd_maintenance == 0 ? '$0' : fmtStat(kv.bd_maintenance,'gross')}</span></div>
    <div class="brow total"><span class="bl">Your Net Payout</span><span class="bv">${fmtStat(kv.bd_net,'payout')}</span></div>`;

  const notices = sc['NOTICES'] || [];
  document.getElementById('notices-panel').innerHTML = notices.length
    ? notices.map(n => `<div class="notice ${n[0]||'info'}">
        <div class="notice-icon">${n[1]||'‚ÑπÔ∏è'}</div>
        <div><div class="notice-title">${n[2]}</div><div class="notice-body">${n[3]}</div></div>
      </div>`).join('')
    : '<div style="padding:8px 4px;font-size:13px;color:var(--text-light)">No notices at this time.</div>';

  const docs = sc['DOCUMENTS'] || [];
  document.getElementById('doc-grid').innerHTML = docs.length
    ? docs.map(d => `<div class="doc-card">
        <div class="doc-icon">${d[0]||'üìÑ'}</div>
        <div class="doc-name">${d[1]}</div>
        <div class="doc-meta">${d[2]}</div>
        <a href="${d[3]||'#'}" class="doc-btn" target="_blank">View</a>
      </div>`).join('')
    : '<div style="grid-column:1/-1;padding:32px;text-align:center;color:var(--text-light)">No documents yet.</div>';
}

/* ‚îÄ‚îÄ TABS & FILTERS ‚îÄ‚îÄ */
function switchTab(id, btn) {
  document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('tab-' + id).classList.add('active');
  btn.classList.add('active');
}

document.addEventListener('click', ev => {
  if (!ev.target.classList.contains('filter-btn')) return;
  document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
  ev.target.classList.add('active');
  const f = ev.target.dataset.filter;
  document.querySelectorAll('#all-res-tbody tr').forEach(r => {
    r.style.display = (f === 'all' || r.dataset.status === f) ? '' : 'none';
  });
});

/* ‚îÄ‚îÄ MESSAGES ‚îÄ‚îÄ */
function sendMessage() {
  const input = document.getElementById('msg-input');
  const text  = input.value.trim();
  if (!text) return;
  const body = document.getElementById('msg-body');
  const ini  = currentOwner?.initials || 'ME';
  body.innerHTML += `<div class="bubble-row me">
    <div class="bubble-av gold-av">${ini}</div>
    <div><div class="bubble me">${esc(text)}</div><div class="bubble-time">Just now ‚Äî sent to Dylan</div></div>
  </div>`;
  body.scrollTop = body.scrollHeight;
  input.value = '';
  window.location.href = 'mailto:' + e('smithdj789','gmail.com') + '?subject=Owner%20Portal%20Message&body=' + encodeURIComponent(text);
}

/* ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ */
function setStat(id, val, sub, delta, isUp) {
  setText(id, val||'‚Äî');
  const s = document.getElementById(id+'-sub');   if(s) s.textContent = sub||'';
  const d = document.getElementById(id+'-delta'); if(d && delta) { d.textContent = delta; d.className = 'delta ' + (isUp ? 'up' : 'down'); }
}
function platC(p) { return (p||'').toLowerCase().replace(/\s/g,''); }
function statC(s) { return (s||'upcoming').toLowerCase(); }
function setText(id, v) { const el = document.getElementById(id); if(el) el.textContent = v; }
function show(id, d='block') { document.getElementById(id).style.display = d; }
function hide(id) { document.getElementById(id).style.display = 'none'; }
function pd(s) { return parseFloat((s||'').replace(/[$,%,‚àí\-\s]/g,''))||0; }
function fmt(n) { return '$' + n.toLocaleString('en-US', {minimumFractionDigits:0}); }

// Auto-formats raw numbers from Google Sheets into display values
// Handles: 3850 ‚Üí $3,850 | 0.81 ‚Üí 81% | 195 ‚Üí $195 | already-formatted strings pass through
function fmtStat(val, key) {
  if (!val && val !== 0) return '‚Äî';
  const s = String(val).trim();
  // Already formatted ‚Äî has $, %, letters ‚Äî pass through as-is
  if (/[$%a-zA-Z]/.test(s)) return s;
  const n = parseFloat(s);
  if (isNaN(n)) return s;
  // Occupancy ‚Äî small decimal like 0.74 or 0.81 ‚Üí percentage
  if (key && key.includes('occ')) {
    return n <= 1 ? Math.round(n * 100) + '%' : Math.round(n) + '%';
  }
  // Rate ‚Äî nightly rate, typically 100-500 range, no cents needed
  if (key && key.includes('rate')) {
    return '$' + Math.round(n).toLocaleString('en-US');
  }
  // Everything else (revenue, payout, gross, net etc.) ‚Äî dollar format
  return '$' + n.toLocaleString('en-US', {minimumFractionDigits:0});
}
function cap(s) { return s ? s.charAt(0).toUpperCase() + s.slice(1) : ''; }
function esc(s) { const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }
</script>
</body>
</html>
